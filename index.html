<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta property="og:image" content="https://iili.io/q2hjvF1.png">
    <meta property="og:title" content="AXON | Music Previewer">
    <meta property="og:description" content="Search and preview music tracks with a sleek interface.">
    <meta property="og:url" content="https://axons.pages.dev/">
    <meta property="og:type" content="website">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AXON | The Futuristic Way Of Music</title>

    <link rel="icon" type="image/png" href="https://coin-images.coingecko.com/coins/images/677/large/basic-attention-token.png?1696501867">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass: rgba(15, 15, 15, 0.4);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent: #6a33ea;
            --bg: #050505;
            --liquid-blur: blur(40px) saturate(180%);
        }

        /* CUSTOM GLOBAL SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            border: 2px solid var(--bg);
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; scrollbar-width: thin; scrollbar-color: rgba(255, 255, 255, 0.1) var(--bg); }
        
        html { height: 100%; overflow-y: scroll; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: #fff; padding-bottom: 20px;
            overflow-x: hidden; min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 0%, rgba(147, 51, 234, 0.12) 0%, transparent 40%),
                radial-gradient(circle at 80% 100%, rgba(59, 130, 246, 0.08) 0%, transparent 40%),
                linear-gradient(180deg, #080808 0%, #050505 100%);
            background-attachment: fixed; background-size: cover;
            transition: padding-bottom 0.4s ease;
        }

        .global-header {
            position: fixed; top: 20px; left: 0; right: 0; margin: 0 auto;
            width: 95%; max-width: 1300px; height: 60px; z-index: 2000;
            backdrop-filter: var(--liquid-blur); -webkit-backdrop-filter: var(--liquid-blur);
            background: var(--glass);
            border: 1px solid var(--glass-border); border-radius: 100px;
            display: flex; align-items: center; padding: 0 30px;
        }

        .header-content { width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .h-left { display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; }
        .h-logo { height: 20px; filter: drop-shadow(0 0 10px var(--accent)); }
        .h-title { font-weight: 800; letter-spacing: 2px; font-size: 0.85rem; }

        .main-wrapper { padding-top: 120px; padding-bottom: 60px; }

        header {
            margin: 20px auto 40px; max-width: 900px; padding: 60px 20px;
            text-align: center; background: var(--glass); 
            backdrop-filter: var(--liquid-blur); -webkit-backdrop-filter: var(--liquid-blur);
            border: 1px solid var(--glass-border); border-radius: 40px;
        }

        h1 { 
            font-size: 4rem; font-weight: 800; letter-spacing: -4px; margin: 0;
            background: linear-gradient(to bottom, #fff 50%, #666);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .search-wrapper {
            display: flex; background: rgba(0, 0, 0, 0.4) !important;
            border: 1px solid var(--glass-border); border-radius: 100px; 
            padding: 5px 8px; max-width: 550px; margin: 30px auto 15px;
            transition: 0.3s;
        }
        .search-wrapper:focus-within { border-color: var(--accent); box-shadow: 0 0 20px rgba(147, 51, 234, 0.2); }

        #searchInput { flex: 1; background: transparent; border: none; outline: none; color: #fff; padding: 12px 20px; font-size: 1rem; }
        #searchBtn { background: #fff; color: #000; border: none; padding: 10px 28px; border-radius: 100px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        #searchBtn:hover { background: var(--accent); color: #fff; }

        .genre-filters { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; padding: 0 20px; }
        .genre-pill {
            background: var(--glass); border: 1px solid var(--glass-border); color: #666; 
            padding: 5px 15px; border-radius: 100px; font-size: 0.65rem; font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        .genre-pill.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        #results {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;
            max-width: 1400px; margin: 0 auto; padding: 0 20px; min-height: 500px;
        }

        .track-card {
            background: rgba(255, 255, 255, 0.02); border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 15px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; height: 100%; position: relative;
        }
        .track-card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--accent); background: rgba(255,255,255,0.05); }
        .track-card img { width: 100%; aspect-ratio: 1/1; border-radius: 16px; object-fit: cover; margin-bottom: 12px; }

        .track-info-wrapper { flex-grow: 1; margin-bottom: 12px; overflow: hidden; }
        .clamp-text { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }

        .skeleton { background: linear-gradient(90deg, #111 25%, #1a1a1a 50%, #111 75%); background-size: 200% 100%; animation: loading 1.5s infinite; border-radius: 12px; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .preview-btn {
            width:100%; 
            background: rgba(106, 51, 234, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(147, 51, 234, 0.3);
            color: #fff; 
            padding: 12px; 
            border-radius: 14px; 
            font-size: 0.65rem; 
            font-weight: 800; 
            cursor: pointer; 
            margin-bottom: 10px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: inset 0 0 10px rgba(147, 51, 234, 0.1);
        }
        .preview-btn:hover {
            background: var(--accent);
            border-color: #fff;
            box-shadow: 0 8px 20px rgba(94, 51, 234, 0.4);
        }

        .global-player {
            position: fixed; bottom: 95px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 850px; 
            background: var(--glass);
            backdrop-filter: var(--liquid-blur); -webkit-backdrop-filter: var(--liquid-blur);
            border: 1px solid var(--glass-border); border-radius: 30px;
            padding: 12px 25px; display: none; align-items: center; z-index: 1500;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .player-left { display: flex; align-items: center; gap: 15px; flex-shrink: 0; max-width: 30%; }
        .player-info { overflow: hidden; }

        #lyricsContainer {
            position: fixed;
            bottom: calc(95px + 100px);
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px;
            max-height: 400px;
            background: rgba(10,10,10,0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 35px;
            display: none;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
            z-index: 2000;
            overflow: hidden; 
        }

        /* SIDEBAR SYNC LEGEND */
        .lyrics-sidebar {
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px;
            padding: 20px 10px; border-left: 1px solid rgba(255,255,255,0.05);
            z-index: 10; pointer-events: none;
        }

        .sync-item { text-align: right; }
        .sync-key { 
            display: block; font-size: 1rem; font-weight: 800; color: var(--accent); 
            text-shadow: 0 0 10px var(--accent); margin-bottom: 2px;
        }
        .sync-label { 
            display: block; font-size: 0.5rem; color: rgba(255,255,255,0.4); 
            text-transform: uppercase; letter-spacing: 1px;
        }
        
        #lyricsScrollArea {
            width: 100%; max-height: 400px; overflow-y: auto; 
            padding: 100px 30px; scroll-behavior: smooth;
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
        }

        #lyricsScrollArea::-webkit-scrollbar { width: 4px; }
        #lyricsScrollArea::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        .lyric-line { 
            padding: 12px 0; 
            font-size: 1.1rem; 
            color: rgba(255, 255, 255, 0.2); 
            transition: 0.4s ease; 
            text-align: center; 
            font-weight: 600; 
        }
        
        .lyric-line.highlight { 
            color: #ffffff !important; 
            font-size: 1.5rem; 
            text-shadow: 0 0 20px var(--accent); 
            opacity: 1; 
            transform: scale(1.05);
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border);
            color: #fff; width: 44px; height: 44px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; flex-shrink: 0;
        }
        .icon-btn:hover { background: #fff; color: #000; transform: scale(1.05); }
        .icon-btn svg { width: 18px; height: 18px; fill: currentColor; }

        .play-pause-main { background: #fff; color: #000; width: 50px; height: 50px; }

        .player-controls-right { display: flex; align-items: center; gap: 10px; margin-left: auto; }

        .volume-wrapper {
            display: flex; align-items: center; gap: 10px; padding: 0 10px;
            border-left: 1px solid var(--glass-border); margin-left: 10px;
        }
        input[type=range].volume-slider { -webkit-appearance: none; width: 80px; background: transparent; }
        input[type=range].volume-slider:focus { outline: none; }
        input[type=range].volume-slider::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer;
            background: rgba(255,255,255,0.1); border-radius: 10px;
        }
        input[type=range].volume-slider::-webkit-slider-thumb {
            height: 12px; width: 12px; border-radius: 50%;
            background: #fff; cursor: pointer; -webkit-appearance: none;
            margin-top: -4px; box-shadow: 0 0 10px var(--accent);
        }

        .progress-container { 
            flex: 1; height: 6px; background: rgba(255,255,255,0.08); 
            border-radius: 10px; cursor: pointer; position: relative; 
            margin: 0 25px; overflow: visible; 
        }
        #progressBar { 
            width: 0%; height: 100%; 
            background: #fff; 
            position: absolute; left: 0; top: 0; border-radius: 10px;
            box-shadow: 0 0 15px var(--accent);
            transition: width 0.1s linear;
        }
        #progressBar::after {
            content: ""; position: absolute; right: -5px; top: 50%; 
            transform: translateY(-50%); width: 12px; height: 12px; 
            background: #fff; border-radius: 50%; box-shadow: 0 0 15px #fff;
        }

        .floating-nav-footer {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px; background: rgba(10,10,10,0.7);
            backdrop-filter: blur(20px); border: 1px solid var(--glass-border);
            border-radius: 100px; padding: 12px 25px; display: flex;
            justify-content: space-between; align-items: center; z-index: 1000;
        }

        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: #555; text-decoration: none; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .nav-links a:hover, .nav-links a.active { color: #fff; }

        .pagination-container { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 40px 0; }
        .page-btn { background: var(--glass); border: 1px solid var(--glass-border); color: #fff; padding: 10px 24px; border-radius: 100px; cursor: pointer; font-weight: 800; font-size: 0.7rem; }
        .page-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        @media (max-width: 768px) { 
            .progress-container, .h-title, .volume-wrapper, .lyrics-sidebar { display: none; }
            #results { grid-template-columns: 1fr; }
            .player-left { max-width: 50%; }
        }
    </style>
</head>
<body>

<nav class="global-header">
    <div class="header-content">
        <a href="index.html" class="h-left">
            <img src="https://coin-images.coingecko.com/coins/images/677/large/basic-attention-token.png?1696501867" class="h-logo" alt="Logo">
            <span class="h-title">AXON</span>
        </a>
        <div style="font-size: 0.6rem; color: #333; font-weight: 800; letter-spacing: 1px;">© 2026</div>
    </div>
</nav>

<div class="main-wrapper">
    <header>
        <h1>AXON</h1>
        <div class="search-wrapper">
            <input id="searchInput" placeholder="Find your music..." type="text" autocomplete="off">
            <button id="searchBtn">Search</button>
        </div>
        <div id="history" style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-top: 10px;"></div>
        <button onclick="toggleFavs()" style="margin-top: 20px; background:none; border:1px solid #333; color:#666; border-radius:100px; padding:6px 18px; cursor:pointer; font-size:0.6rem; font-weight:800;">✦ SAVED</button>
    </header>

    <div class="genre-filters">
        <div class="genre-pill active" onclick="filterGenre('All')">All</div>
        <div class="genre-pill" onclick="filterGenre('Pop')">Pop</div>
        <div class="genre-pill" onclick="filterGenre('Hip-Hop')">Hip-Hop</div>
        <div class="genre-pill" onclick="filterGenre('Electronic')">Electronic</div>
        <div class="genre-pill" onclick="filterGenre('Rock')">Rock</div>
    </div>

    <main id="results"></main>

    <div class="pagination-container" id="paginationControls" style="display: none;">
        <button id="prevBtn" class="page-btn" onclick="changePage(-1)">PREV</button>
        <span id="pageIndicator" style="font-size: 0.7rem; font-weight: 800;">PAGE 1</span>
        <button id="nextBtn" class="page-btn" onclick="changePage(1)">NEXT</button>
    </div>
</div>

<div id="lyricsContainer">
    <div class="lyrics-sidebar">
        <div class="sync-item">
            <span class="sync-key">[</span>
            <span class="sync-label">Sync Back</span>
        </div>
        <div class="sync-item">
            <span class="sync-key">]</span>
            <span class="sync-label">Sync Ahead</span>
        </div>
    </div>
    <div id="lyricsScrollArea"></div>
</div>

<div id="playerBar" class="global-player">
    <div class="player-left">
        <img id="playerImg" src="" style="width: 50px; height: 50px; border-radius: 12px; object-fit: cover;">
        <div class="player-info">
            <b id="playerTitle" class="clamp-text" style="font-size: 0.85rem; display: block;">Track Name</b>
            <span id="playerArtist" class="clamp-text" style="font-size: 0.7rem; color: #777;">Artist Name</span>
        </div>
    </div>

    <div class="progress-container" onclick="seek(event)">
        <div id="progressBar"></div>
    </div>

    <div class="player-controls-right">
        <button id="playPauseBtn" class="icon-btn play-pause-main" onclick="togglePlay()">
            <svg viewBox="0 0 24 24" id="playIcon" style="display:none;"><path d="M8 5v14l11-7z"/></svg>
            <svg viewBox="0 0 24 24" id="pauseIcon"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </button>
        
        <div class="volume-wrapper">
            <svg viewBox="0 0 24 24" style="width:14px; fill:#555;"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1" oninput="changeVolume(this.value)">
        </div>

        <a id="downloadBtn" href="#" download class="icon-btn" title="Download Preview">
            <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
        </a>
        <button class="icon-btn" onclick="toggleLyrics()" title="Lyrics">
            <svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
        </button>
        <button class="icon-btn" onclick="closePlayer()" style="background:transparent; border:none; opacity:0.4;">
            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
    </div>
    
    <audio id="globalAudio" autoplay style="display:none;"></audio>
</div>

<nav class="floating-nav-footer">
    <div style="font-size: 0.8rem; font-weight: 800; color: var(--accent); letter-spacing:1px;">AXON</div>
    <div class="nav-links">
        <a href="index.html" class="active">Home</a>
        <a href="About.html">About</a>
        <a href="Members.html">Members</a>
        <a href="Sources.html">Sources</a>
        <a href="Under.Construction.html">Lab</a>
    </div>
</nav>

<script>
    const input = document.getElementById('searchInput');
    const grid = document.getElementById('results');
    const pagControls = document.getElementById('paginationControls');
    const audio = document.getElementById('globalAudio');
    const lyricsContainer = document.getElementById('lyricsContainer');
    const lyricsScrollArea = document.getElementById('lyricsScrollArea');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const progressBar = document.getElementById('progressBar');
    const downloadBtn = document.getElementById('downloadBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    
    let allResults = [];
    let filteredResults = [];
    let currentPage = 1;
    const itemsPerPage = 20; 
    let showOnlyFavs = false;
    let currentLyrics = [];
    let lyricOffset = 0; 
    
    let isUserScrolling = false;
    let scrollTimeout;

    let history = JSON.parse(localStorage.getItem('axon_history') || '[]');
    let favorites = JSON.parse(localStorage.getItem('axon_favs') || '[]');

    function saveHistory(term) {
        if (!term) return;
        history = [term, ...history.filter(t => t !== term)].slice(0, 5);
        localStorage.setItem('axon_history', JSON.stringify(history));
        renderHistory();
    }

    function renderHistory() {
        document.getElementById('history').innerHTML = history.map(t => `<div onclick="quickSearch('${t}')" style="cursor:pointer; color:#444; font-size:0.6rem; border:1px solid #222; padding:4px 12px; border-radius:100px;">${t}</div>`).join('');
    }

    window.quickSearch = (t) => { input.value = t; search(); };

    async function search() {
        const q = input.value.trim();
        if (!q) return;
        showOnlyFavs = false;
        currentPage = 1;
        saveHistory(q);
        
        grid.innerHTML = Array(10).fill(0).map(() => `
            <div class="track-card" style="opacity:0.5">
                <div class="skeleton" style="width:100%; aspect-ratio:1/1; margin-bottom:12px;"></div>
                <div class="skeleton" style="width:70%; height:15px; margin-bottom:8px;"></div>
                <div class="skeleton" style="width:40%; height:10px;"></div>
            </div>
        `).join('');

        try {
            const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(q)}&media=music&limit=100`);
            const data = await res.json();
            allResults = data.results;
            filteredResults = allResults;
            render();
        } catch (e) { grid.innerHTML = "Error fetching data."; }
    }

    function filterGenre(genre) {
        document.querySelectorAll('.genre-pill').forEach(p => p.classList.toggle('active', p.innerText === genre));
        filteredResults = (genre === 'All') ? allResults : allResults.filter(t => t.primaryGenreName && t.primaryGenreName.includes(genre));
        currentPage = 1;
        render();
    }

    async function fetchLyrics(title, artist) {
        lyricsScrollArea.innerHTML = '<div class="lyric-line" style="color:#fff">Searching...</div>';
        currentLyrics = [];
        lyricOffset = 0; 
        try {
            const res = await fetch(`https://lrclib.net/api/get?artist_name=${encodeURIComponent(artist)}&track_name=${encodeURIComponent(title)}`);
            const data = await res.json();
            if (data.syncedLyrics) parseLyrics(data.syncedLyrics);
            else if (data.plainLyrics) lyricsScrollArea.innerHTML = `<div class="lyric-line" style="color:#fff; opacity:0.8;">${data.plainLyrics.replace(/\n/g, '<br>')}</div>`;
            else lyricsScrollArea.innerHTML = '<div class="lyric-line" style="color:#fff">No lyrics found.</div>';
        } catch (e) { lyricsScrollArea.innerHTML = '<div class="lyric-line" style="color:#fff">Lyrics unavailable.</div>'; }
    }

    function parseLyrics(lrc) {
        const lines = lrc.split('\n');
        currentLyrics = lines.map(line => {
            const match = line.match(/\[(\d+):(\d+\.\d+)\](.*)/);
            if (match) return { time: parseInt(match[1]) * 60 + parseFloat(match[2]), text: match[3].trim() };
            return null;
        }).filter(l => l && l.text);
        lyricsScrollArea.innerHTML = currentLyrics.map((l, i) => `<div class="lyric-line" id="lyric-${i}">${l.text}</div>`).join('');
    }

    function toggleLyrics() {
        lyricsContainer.style.display = lyricsContainer.style.display === 'block' ? 'none' : 'block';
    }

    function togglePlay() {
        if (audio.src) {
            if (audio.paused) { audio.play(); playIcon.style.display = 'none'; pauseIcon.style.display = 'block'; } 
            else { audio.pause(); playIcon.style.display = 'block'; pauseIcon.style.display = 'none'; }
        }
    }

    function changeVolume(val) {
        audio.volume = val;
    }

    window.addEventListener('keydown', (e) => {
        if (document.activeElement === input) return; 
        
        if (e.code === 'Space') {
            e.preventDefault();
            togglePlay();
        } else if (e.code === 'ArrowRight') {
            audio.currentTime = Math.min(audio.duration, audio.currentTime + 3);
        } else if (e.code === 'ArrowLeft') {
            audio.currentTime = Math.max(0, audio.currentTime - 3);
        } else if (e.key === ']') {
            lyricOffset += 1; 
        } else if (e.key === '[') {
            lyricOffset -= 1; 
        }
    });

    audio.ontimeupdate = () => {
        const curTime = audio.currentTime;
        const duration = audio.duration;

        if (duration) {
            progressBar.style.width = (curTime / duration) * 100 + '%';
        }

        if (!currentLyrics.length || isUserScrolling) return;
        
        const syncTime = curTime + lyricOffset;

        for (let i = 0; i < currentLyrics.length; i++) {
            if (syncTime >= currentLyrics[i].time && (!currentLyrics[i+1] || syncTime < currentLyrics[i+1].time)) {
                document.querySelectorAll('.lyric-line').forEach(el => el.classList.remove('highlight'));
                const activeLine = document.getElementById(`lyric-${i}`);
                if (activeLine) { 
                    activeLine.classList.add('highlight'); 
                    activeLine.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                }
                break;
            }
        }
    };

    function seek(e) {
        const rect = e.currentTarget.getBoundingClientRect();
        const pct = (e.clientX - rect.left) / rect.width;
        audio.currentTime = pct * audio.duration;
    }

    function playTrack(url, title, artist, img) {
        document.getElementById('playerTitle').innerText = title;
        document.getElementById('playerArtist').innerText = artist;
        document.getElementById('playerImg').src = img.replace('100x100','600x600');
        
        audio.pause();
        audio.src = url;
        downloadBtn.href = url;
        document.getElementById('playerBar').style.display = 'flex';
        document.body.style.paddingBottom = "160px";
        
        audio.play();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        
        isUserScrolling = false;
        fetchLyrics(title, artist);
    }

    function closePlayer() { 
        document.getElementById('playerBar').style.display = 'none'; 
        audio.pause(); 
        lyricsContainer.style.display = 'none'; 
        document.body.style.paddingBottom = "20px";
    }

    function render() {
        grid.innerHTML = '';
        const dataPool = showOnlyFavs ? favorites : filteredResults;
        const startIndex = (currentPage - 1) * itemsPerPage;
        const paginatedData = dataPool.slice(startIndex, startIndex + itemsPerPage);

        if (dataPool.length > itemsPerPage) {
            pagControls.style.display = 'flex';
            document.getElementById('pageIndicator').innerText = `PAGE ${currentPage}`;
            document.getElementById('prevBtn').disabled = (currentPage === 1);
            document.getElementById('nextBtn').disabled = (startIndex + itemsPerPage >= dataPool.length);
        } else { pagControls.style.display = 'none'; }

        paginatedData.forEach(track => {
            const isFav = favorites.some(f => f.trackId === track.trackId);
            const card = document.createElement('div');
            card.className = 'track-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span style="font-size:0.6rem; color:#333;">ID_${track.trackId}</span>
                    <button style="background:none; border:none; color:${isFav ? 'var(--accent)' : '#222'}; cursor:pointer;" onclick='toggleFav(${track.trackId}, ${JSON.stringify(track).replace(/'/g, "&apos;")})'>✦</button>
                </div>
                <img src="${track.artworkUrl100.replace('100x100','600x600')}" loading="lazy">
                <div class="track-info-wrapper">
                    <b class="clamp-text" style="font-size:0.8rem;">${track.trackName}</b>
                    <span class="clamp-text" style="font-size:0.7rem; color:#555;">${track.artistName}</span>
                </div>
                <button class="preview-btn" onclick="playTrack('${track.previewUrl}', '${track.trackName.replace(/'/g, "\\'")}', '${track.artistName.replace(/'/g, "\\'")}', '${track.artworkUrl100}')">PREVIEW</button>
                <a href="${track.trackViewUrl}" target="_blank" style="text-align:center; text-decoration:none; color:var(--accent); font-size:0.6rem; font-weight:800; border:1px solid rgba(147,51,234,0.2); padding:6px; border-radius:10px;">APPLE MUSIC</a>
            `;
            grid.appendChild(card);
        });
    }

    function toggleFav(id, trackData) {
        const idx = favorites.findIndex(f => f.trackId === id);
        if (idx > -1) favorites.splice(idx, 1); else favorites.push(trackData);
        localStorage.setItem('axon_favs', JSON.stringify(favorites));
        render();
    }

    function toggleFavs() { showOnlyFavs = !showOnlyFavs; currentPage = 1; render(); }
    function changePage(step) { currentPage += step; render(); window.scrollTo({top: 0, behavior: 'smooth'}); }

    document.getElementById('searchBtn').onclick = search;
    input.addEventListener('keydown', (e) => { if(e.key === 'Enter') search(); });
    renderHistory();
</script>
</body>
</html>
